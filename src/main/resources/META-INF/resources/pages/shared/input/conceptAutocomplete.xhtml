<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:cc="http://java.sun.com/jsf/composite"
        xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html"
>

    <cc:interface>

        <cc:attribute name="completeMethod" required="true" method-signature="java.util.List &lt;java.lang.String&gt;(java.lang.String)" />
        <cc:attribute name="itemSelectListener" required="false" method-signature="void &lt;java.lang.String&gt;()" />
        <cc:attribute name="selectedConcept" type="fr.siamois.infrastructure.database.repositories.vocabulary.dto.ConceptAutocompleteDTO" required="true"/>
        <cc:attribute name="editConceptUrl" required="true"/>
        <cc:attribute name="disabled" required="false" default="false"/>
        <cc:attribute name="ajaxUpdateTargets" required="false"/>
        <cc:attribute name="ajaxProcessTargets" required="false"/>
        <cc:attribute name="panelStyleClass" required="false" default="sia-autocomplete-panel"/>
        <cc:attribute name="required" default="true" type="boolean"/>


    </cc:interface>

    <cc:implementation>
        <p:autoComplete value="#{cc.attrs.selectedConcept}"
                        id="conceptAutocomplete"
                        completeMethod="#{cc.attrs.completeMethod}"
                        var="autocompleteDto"
                        panelStyleClass="#{cc.attrs.panelStyleClass}"
                        itemValue="#{autocompleteDto}"
                        itemLabel="#{autocompleteDto.conceptLabelToDisplay.label}"
                        disabled="#{cc.attrs.disabled}"
                        required="#{cc.attrs.required}"
                        converter="#{conceptAutocompleteDTOConverter}"
                        forceSelection="true"
                        scrollHeight="300"
                        dropdown="true"
                        placeholder="#{langBean.msg('common.action.chooseConcept')}"
                        showEmptyMessage="false"
        >
            <f:attribute name="filter" value="#{filter}" />

            <!-- If defined, we need to update on select to synchronise secondary type choices -->
            <p:ajax
                    listener="#{cc.attrs.itemSelectListener}"
                    disabled="#{empty cc.attrs.itemSelectListener}"
                    update="#{cc.attrs.ajaxUpdateTargets}"
                    immediate="true"
                    process="#{cc.attrs.ajaxProcessTargets}"/>

            <p:column>

                <h:panelGroup id="conceptItem" layout="block" style="display:flex; flex-direction: column">
                    <h:outputText style="vertical-align: middle" value="#{autocompleteDto.conceptLabelToDisplay.label}"/>
                    <h:panelGroup rendered="#{autocompleteDto.conceptLabelToDisplay.altLabel}">
                        <small>#{langBean.msg('concept.common.preflabel')} : #{autocompleteDto.originalPrefLabel}</small>
                    </h:panelGroup>
                    <h:panelGroup rendered="#{not empty autocompleteDto.hierarchyPrefLabels}">
                        <small>#{langBean.msg('concept.common.parents')} : #{autocompleteDto.hierarchyPrefLabels}</small>
                    </h:panelGroup>
                </h:panelGroup>

            </p:column>

            <f:facet name="footer">
                <div class="ui-fluid" style="padding:0.5rem 1rem 1rem 1rem">
                    <h:outputLink value="#{cc.attrs.editConceptUrl}" target="_blank"
                                  disabled="#{empty cc.attrs.editConceptUrl}"
                                  styleClass="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
                        <span class="ui-button-text">#{langBean.msg('common.action.editConcept')}</span>
                    </h:outputLink>
                </div>
            </f:facet>
        </p:autoComplete>

    </cc:implementation>

</ui:composition>