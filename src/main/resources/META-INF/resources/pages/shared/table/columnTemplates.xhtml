<!-- /resources/components/columnTemplates.xhtml -->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:cellheader="http://java.sun.com/jsf/composite/pages/shared/cellheader"
>

    <!-- Header -->
    <f:facet name="header">
        <p:outputPanel rendered="#{column.type ne 'COMMAND_LINK'}">
            #{langBean.msg(column.headerKey)}
        </p:outputPanel>
        <p:outputPanel rendered="#{column.type eq 'COMMAND_LINK'}">

        </p:outputPanel>
    </f:facet>

    <!-- Row Context -->
    <ui:param name="rowContext" value="#{tableModel.getRowContext(item)}"/>

    <ui:fragment rendered="#{column.type eq 'FORM_FIELD'}">
        <ui:include src="/pages/shared/form/customFormFieldContentForTable.xhtml">
            <ui:param name="bean" value="#{rowContext}"/>
            <ui:param name="col" value="#{column}"/>
            <ui:param name="prefix" value="table"/>
            <ui:param name="statusIndex" value="#{status.index}"/>
            <ui:param name="rowIndex" value="#{rowIndex}"/>
            <ui:param name="colIndex" value="#{colIndex}"/>
            <ui:param name="root" value="#{component.clientId}"/>
            <ui:param name="panelIndex" value="0"/>
            <ui:param name="onModified" value="#{rowContext.onFieldAnswerModifiedListener}"/>
            <ui:param name="answer" value="#{rowContext.getFieldAnswer(column.field)}"/>
            <ui:param name="hasBeenModified" value="#{answer != null and answer.hasBeenModified}"/>
            <ui:param name="hasAutoGenerationFunction" value="false"/>
            <ui:param name="onGenerateValue" value="#{null}"/>
            <ui:param name="updateTargetsOnBlur" value="#{updateTableString}" />
            <ui:param name="allowEdit" value="#{canUserEditRow}"/>
        </ui:include>
    </ui:fragment>

    <!-- COMMAND_LINK Column -->
    <ui:fragment rendered="#{column.type eq 'COMMAND_LINK'}">
        <p:commandButton
                styleClass="hidden-column"
                action="#{tableModel.handleAction(column, item, panelIndex)}"
                onstart="#{column.onstartJs}"
                icon="bi bi-box-arrow-up-right"
                oncomplete="#{column.oncompleteJs}"
                process="#{column.processExpr}"
                style="sia-icon-btn"
                update="#{column.updateExpr}">
        </p:commandButton>
    </ui:fragment>

    <!-- RELATION Column -->
    <ui:fragment rendered="#{column.type eq 'RELATION'}">
        <f:facet name="header">
            <cellheader:withIcon icon="#{column.headerIcon}" text="#{langBean.msg(column.headerKey)}"/>
        </f:facet>
        <div style="display:flex; gap:1em; align-items:center;">
            <span>#{tableModel.resolveCount(column, item)}</span>
            <p:commandButton
                    icon="#{column.viewIcon}"
                    action="#{tableModel.handleRelationAction(column, item, panelIndex, 'VIEW_RELATION')}"
                    styleClass="sia-icon-btn"
                    process="#{column.processExpr}"
                    update="#{column.updateExpr}"
                    onstart="#{column.onstartJs}"
                    oncomplete="#{column.oncompleteJs}"/>
            <p:commandButton
                    rendered="#{column.addEnabled and tableModel.isRendered(column, column.addRenderedKey, item, panelIndex)}"
                    styleClass="sia-icon-btn"
                    icon="#{column.addIcon}"
                    action="#{tableModel.handleRelationAction(column, item, panelIndex, 'ADD_RELATION')}"
                    oncomplete="PF('newUnitDiag').show()"
                    update="newUnitForm"/>
        </div>
    </ui:fragment>
</ui:composition>
