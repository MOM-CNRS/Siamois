<!-- /pages/shared/table/entityDataTable.xhtml -->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
>

    <p:dataTable paginator="true"
                 rendered="#{not tableModel.treeMode}"
                 cellNavigation="true"
                 id="entityDatatable"
                 varStatus="status"
                 size="small"
                 rowHover="true"
                 paginatorPosition="bottom"
                 var="item"
                 selectionPageOnly="false"
                 selectionRowMode="none"
                 selection="#{tableModel.lazyDataModel.selectedUnits}"
                 widgetVar="#{cc.clientId}_entityDatatable"
                 lazy="true"
                 rowKey="#{item.id}"
                 globalFilter="#{tableModel.globalFilter}"
                 allowUnsorting="true"
                 sortBy="#{tableModel.lazyDataModel.sortBy}"
                 rows="#{tableModel.lazyDataModel.pageSizeState}"
                 first="#{tableModel.lazyDataModel.first}"
                 sortMode="multiple"
                 partialUpdate="false"
                 emptyMessage="#{langBean.msg('recordingUnitList.empty')}"
                 paginatorTemplate="Rows per page: {RowsPerPageDropdown} {RowReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                 rowsPerPageTemplate="5,10,15,20,25"
                 rowIndexVar="rowIndex"
                 tableStyle="table-layout: auto;"
                 tableStyleClass="datatable-hoverable-table"
                 value="#{tableModel.lazyDataModel}"
                 class="#{tableClass}">

        <f:facet name="{RowReport}">
            <span class="ui-paginator-current">
                #{tableModel.lazyDataModel.getFirstIndexOnPage()}-#{tableModel.lazyDataModel.getLastIndexOnPage()} of #{tableModel.lazyDataModel.rowCount}
            </span>
        </f:facet>

        <f:facet name="header">
            <ui:include src="/pages/shared/table/tableToolbar.xhtml">
                <ui:param name="tableModel" value="#{tableModel}" />
                <ui:param name="updateTableString" value="#{updateTableString}" />
                <ui:param name="tableId" value="entityDatatable"/>
            </ui:include>
        </f:facet>

        <p:column selectionBox="true" style="width:16px;text-align:center" toggleable="false"/>

        <!-- Dynamic Columns -->
        <p:columns style="min-width: #{column.type != 'COMMAND_LINK' ? '10em' : ''};"
                   id="form"
                   field="#{column.id}"
                   sortable="#{column.sortable}"
                   filterable="#{column.filterable}"
                   toggleable="#{column.type != 'COMMAND_LINK' ? 'true' : 'false'}" value="#{tableModel.columns}"
                   var="column" varStatus="colStatus">
            <ui:include src="/pages/shared/table/columnTemplates.xhtml">
                <ui:param name="tableModel" value="#{tableModel}" />
                <ui:param name="column" value="#{column}" />
                <ui:param name="item" value="#{item}" />
                <ui:param name="status" value="#{status}" />
                <ui:param name="rowIndex" value="#{item.id}" />
                <ui:param name="colStatus" value="#{colStatus}" />
                <ui:param name="updateTableString" value="@this #{updateTableString}"/>
                <ui:param name="canUserEditRow" value="#{tableModel.canUserEditRow(item)}"/>
            </ui:include>
        </p:columns>

        <!-- Actions Column -->
        <p:column exportable="false" toggleable="false" style="min-width: 100px;">
            <p:toolbar>
                <p:toolbarGroup>
                    <ui:repeat value="#{tableModel.rowActions}" var="action">
                        <p:commandButton
                                rendered="#{tableModel.isRendered(action, item)}"
                                icon="#{tableModel.resolveIcon(action, item)}"
                                action="#{tableModel.handleRowAction(action, item)}"
                                process="#{empty action.processExpr ? '@this' : action.processExpr}"
                                update="#{action.updateSelfTable ? (':'.concat(cc.clientId).concat(':entityDatatable')) : action.updateExpr}"
                                styleClass="#{action.styleClass}"/>
                    </ui:repeat>
                </p:toolbarGroup>
            </p:toolbar>
        </p:column>
    </p:dataTable>

    <p:blockUI block="entityDatatable" trigger="entityDatatable" widgetVar="#{cc.clientId}_buiEntityDatatable">
        <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
    </p:blockUI>
</ui:composition>
