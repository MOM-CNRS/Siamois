<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
             xmlns:p="http://primefaces.org/ui"
             xmlns:c="http://java.sun.com/jsp/jstl/core"
             xmlns:f="http://xmlns.jcp.org/jsf/core"
             xmlns:h="http://xmlns.jcp.org/jsf/html"
             xmlns:sharedInput="http://xmlns.jcp.org/jsf/composite/pages/shared/input"
>

    <!--@elvariable id="bean" type="fr.siamois.ui.bean.panel.models.panel.single.AbstractSingleEntity"-->
    <!--@elvariable id="customFormPanel" type="fr.siamois.domain.models.form.customform.CustomFormPanel" -->
    <!--@elvariable id="readOnly" type="java.lang.Boolean" -->
    <!--@elvariable id="prefix" type="String" -->
    <!--@elvariable id="root" type="String" -->
    <!--@elvariable id="updateTargetsOnBlur" type="String" -->
    <!--@elvariable id="statusIndex" type="Object" -->
    <!--@elvariable id="ctx" type="package fr.siamois.ui.form.EntityFormContext" -->


    <p:panelGrid id="customFormPanelGrid-#{statusIndex}-#{prefix}"
                 layout="grid"
    >
        <c:forEach items="#{customFormPanel.rows}" var="row" varStatus="rowStatus">
            <p:row id="row-#{prefix}-#{statusIndex}-#{rowStatus.index}">

                <c:forEach items="#{row.columns}" var="col" varStatus="colStatus">
                    <p:column styleClass="#{col.className}"
                              id="col-#{prefix}-#{statusIndex}-#{rowStatus.index}-#{colStatus.index}">
                        <ui:include src="/pages/shared/form/customFormFieldContentForPanel.xhtml">
                            <ui:param name="bean" value="#{bean}"/>
                            <ui:param name="col" value="#{col}"/>
                            <ui:param name="hasBeenModified"
                                      value="#{bean.formResponse.answers.get(col.field).hasBeenModified}"/>
                            <ui:param name="prefix" value="#{prefix}"/>
                            <ui:param name="statusIndex" value="#{statusIndex}"/>
                            <ui:param name="rowIndex" value="#{rowStatus.index}"/>
                            <ui:param name="colIndex" value="#{colStatus.index}"/>
                            <ui:param name="root" value="#{root}"/>
                            <ui:param name="panelIndex" value="#{panelIndex}"/>
                            <ui:param name="answer" value="#{bean.formResponse.answers.get(col.field)}"/>
                            <ui:param name="onModified" value="#{ctx.onFieldAnswerModifiedListener}"/>
                            <ui:param name="panelHeaderUpdateId" value="#{bean.getPanelHeaderUpdateId(panelIndex)}"/>
                            <ui:param name="onGenerateValue" value="#{bean.generateValueForField}"/>
                            <ui:param name="hasAutoGenerationFunction"
                                      value="#{bean.hasAutoGenerationFunction(col.field)}"/>
                        </ui:include>
                    </p:column>
                </c:forEach>
            </p:row>
        </c:forEach>
    </p:panelGrid>


    <p:panelGrid
            layout="grid">

        <p:row>
            <p:column styleClass="ui-g-12">
                <sharedInput:panelField
                        required="true"
                        title="Relations stratigraphique"
                        fluid="false"

                >
                    <div>
                        <p:card styleClass="add-strati-rel" style="
    border: 1px dashed oklch(0.74 0 0);
    border-radius: 1em;
    background: #ffffff;">

                            <p:selectOneMenu filter="true">
                                <f:selectItem itemLabel="Relation" itemValue=""/>
                                <f:selectItem itemLabel="UE 254" itemValue=""/>
                                <f:selectItem itemLabel="029" itemValue="Option1"/>
                                <f:selectItem itemLabel="27698" itemValue="Option2"/>
                            </p:selectOneMenu>

                            <p:selectOneMenu filter="true">
                                <f:selectItem itemLabel="UE" itemValue=""/>
                                <f:selectItem itemLabel="UE 254" itemValue=""/>
                                <f:selectItem itemLabel="029" itemValue="Option1"/>
                                <f:selectItem itemLabel="27698" itemValue="Option2"/>
                            </p:selectOneMenu>


                            <p:selectBooleanCheckbox itemLabel="Incertain"/>
                            <p:commandButton icon="pi pi-check" value="Ajouter"/>
                        </p:card>

                        <p:outputPanel layout="block" style="border: 2px solid var(--light-color-200);
  margin-top: 1em;
    border-radius: 2em;display:flex;">

                            <svg style="flex:3;" id="stratigraphy" width="800" height="500"></svg>

                            <!-- Side panel using PrimeFaces -->
                            <div class="side-panel-content">

                                <!-- Title -->
                                <h3 id="relationTitle" class="relation-title relation-edit-row">
                                    US 100
                                    <!-- Relation type -->
                                    <p:selectOneMenu id="relationType"
                                                     value="#{relationBean.selectedType}"
                                                     styleClass="relation-select">
                                        <f:selectItem itemLabel="s'appuie contre" itemValue="above"/>
                                        <f:selectItem itemLabel="sous" itemValue="below"/>
                                        <f:selectItem itemLabel="équivalent à" itemValue="side"/>
                                        <f:selectItem itemLabel="incertain" itemValue="uncertain"/>
                                    </p:selectOneMenu>
                                    <!-- Target US -->
                                    <p:selectOneMenu id="relationTarget"
                                                     value="us 23"
                                                     styleClass="relation-select">
                                        <f:selectItem itemLabel="US 43" itemValue="above"/>
                                        <f:selectItem itemLabel="US 87" itemValue="below"/>
                                    </p:selectOneMenu>
                                </h3>



                                <!-- Documents -->
                                <h4 class="section-title">Documents</h4>

                                <div id="relationDocs" class="docs-container">
                                    <!-- Example document 1 -->
                                    <span class="doc-chip"
                                          style="display:inline-block; padding:2px 6px; border:1px solid #ccc; border-radius:4px; margin:2px;">
        coupe_stratigraphique.pdf
        <button type="button" onclick="this.parentElement.remove()"
                style="border:none; background:none; cursor:pointer; margin-left:4px;">✕</button>
    </span>

                                    <!-- Example document 2 -->
                                    <span class="doc-chip"
                                          style="display:inline-block; padding:2px 6px; border:1px solid #ccc; border-radius:4px; margin:2px;">
        notes_terrain.docx
        <button type="button" onclick="this.parentElement.remove()"
                style="border:none; background:none; cursor:pointer; margin-left:4px;">✕</button>
    </span>
                                </div>


                                <p:commandButton value="Ajouter un document"
                                                 icon="pi pi-plus"
                                                 style="color:#7e1717;"
                                                 styleClass="ui-button-outlined add-doc-btn"
                                                 action="#{relationBean.addDocument}"/>



                                <!-- Delete -->
                                <p:commandButton value="Supprimer la relation"
                                                 icon="pi pi-trash"
                                                 styleClass="ui-button-danger delete-relation-btn"
                                                 action="#{relationBean.deleteRelation}"
                                                 update="@form"/>

                            </div>


                            <h:outputScript>
                                initStratigraphyIfNeeded();
                            </h:outputScript>
                        </p:outputPanel>


                        <p:panelGrid style="padding: 0.5em; color: var(--text-light);"
                                     layout="grid"
                        >
                            <p:row>
                                <p:column styleClass="col-xl-4 col-lg-4 col-md-12 col-sm-12 col-12">

                                    <p:outputLabel value="Posterieures"></p:outputLabel>
                                    <div style="display:flex; gap:0.5em;flex-wrap: wrap;">
                                        <p:card styleClass="strati-rel-card"
                                                style="border-radius:2em;border-style: solid;border-color: #d8d8d8;">

                                            <div>
                                                <span>UE 100 s'appuie contre </span>
                                                <p:commandLink value="UE 56"/>
                                            </div>
                                            <p:selectBooleanCheckbox itemLabel="Incertain"/>
                                            <div style="display:flex;flex-direction:column;gap:0.5em;">
                                                <p:chip label="document1.pdf" style="width:fit-content;"
                                                        styleClass="mr-2"
                                                        removable="true"/>
                                                <p:chip label="photo.png" style="width:fit-content;" styleClass="mr-2"
                                                        removable="true"/>
                                            </div>

                                            <f:facet name="footer">
                                                <div style="display:flex;gap:0.5em;">
                                                    <p:commandButton icon="bi bi-paperclip"
                                                                     styleClass="rounded-button ui-button-outlined"/>
                                                    <p:commandButton icon="bi bi-pen"
                                                                     styleClass="rounded-button ui-button-outlined"/>
                                                    <p:commandButton icon="bi bi-x-lg"
                                                                     styleClass="rounded-button ui-button-flat ui-button-danger"/>
                                                </div>
                                            </f:facet>
                                        </p:card>
                                        <p:card styleClass="strati-rel-card"
                                                style="border-radius:2em;border-style: dashed;border-color: #d8d8d8;">

                                            <div>
                                                <span>UE 100 s'appuie contre </span>
                                                <p:commandLink value="UE 56"/>
                                            </div>
                                            <p:selectBooleanCheckbox itemLabel="Incertain" value="true"/>
                                            <div style="display:flex;flex-direction:column;gap:0.5em;">
                                                <p:chip label="document1.pdf" style="width:fit-content;"
                                                        styleClass="mr-2"
                                                        removable="true"/>
                                                <p:chip label="photo.png" style="width:fit-content;" styleClass="mr-2"
                                                        removable="true"/>
                                            </div>

                                            <f:facet name="footer">
                                                <div style="display:flex;gap:0.5em;">
                                                    <p:commandButton icon="bi bi-paperclip"
                                                                     styleClass="rounded-button ui-button-outlined"/>
                                                    <p:commandButton icon="bi bi-pen"
                                                                     styleClass="rounded-button ui-button-outlined"/>
                                                    <p:commandButton icon="bi bi-x-lg"
                                                                     styleClass="rounded-button ui-button-flat ui-button-danger"/>
                                                </div>
                                            </f:facet>
                                        </p:card>
                                    </div>
                                </p:column>
                                <p:column styleClass="col-xl-4 col-lg-4 col-md-12 col-sm-12 col-12">
                                    <p:outputLabel value="Posterieures"></p:outputLabel>
                                    <div style="display:flex; gap:0.5em;flex-wrap: wrap;">
                                        <p:card styleClass="strati-rel-card"
                                                style="border-radius:2em;border-style: solid;border-color: #d8d8d8;">

                                            <div>
                                                <span>UE 100 s'appuie contre </span>
                                                <p:commandLink value="UE 56"/>
                                            </div>
                                            <p:selectBooleanCheckbox itemLabel="Incertain"/>
                                            <div style="display:flex;flex-direction:column;gap:0.5em;">
                                                <p:chip label="document1.pdf" style="width:fit-content;"
                                                        styleClass="mr-2"
                                                        removable="true"/>
                                                <p:chip label="photo.png" style="width:fit-content;" styleClass="mr-2"
                                                        removable="true"/>
                                            </div>

                                            <f:facet name="footer">
                                                <div style="display:flex;gap:0.5em;">
                                                    <p:commandButton icon="bi bi-paperclip"
                                                                     styleClass="rounded-button ui-button-outlined"/>
                                                    <p:commandButton icon="bi bi-pen"
                                                                     styleClass="rounded-button ui-button-outlined"/>
                                                    <p:commandButton icon="bi bi-x-lg"
                                                                     styleClass="rounded-button ui-button-flat ui-button-danger"/>
                                                </div>
                                            </f:facet>
                                        </p:card>

                                    </div>
                                </p:column>
                                <p:column styleClass="col-xl-4 col-lg-4 col-md-12 col-sm-12 col-12">
                                    <p:outputLabel value="Posterieures"></p:outputLabel>
                                    <div style="display:flex; gap:0.5em;flex-wrap: wrap;">
                                        <p:card styleClass="strati-rel-card"
                                                style="border-radius:2em;border-style: solid;border-color: #d8d8d8;">

                                            <div>
                                                <span>UE 100 s'appuie contre </span>
                                                <p:commandLink value="UE 56"/>
                                            </div>
                                            <p:selectBooleanCheckbox itemLabel="Incertain"/>
                                            <div style="display:flex;flex-direction:column;gap:0.5em;">
                                                <p:chip label="document1.pdf" style="width:fit-content;"
                                                        styleClass="mr-2"
                                                        removable="true"/>
                                                <p:chip label="photo.png" style="width:fit-content;" styleClass="mr-2"
                                                        removable="true"/>
                                            </div>

                                            <f:facet name="footer">
                                                <div style="display:flex;gap:0.5em;">
                                                    <p:commandButton icon="bi bi-paperclip"
                                                                     styleClass="rounded-button ui-button-outlined"/>
                                                    <p:commandButton icon="bi bi-pen"
                                                                     styleClass="rounded-button ui-button-outlined"/>
                                                    <p:commandButton icon="bi bi-x-lg"
                                                                     styleClass="rounded-button ui-button-flat ui-button-danger"/>
                                                </div>
                                            </f:facet>
                                        </p:card>
                                    </div>
                                </p:column>
                            </p:row>

                        </p:panelGrid>
                    </div>
                </sharedInput:panelField>
            </p:column>
        </p:row>

    </p:panelGrid>


    <ui:fragment rendered="#{empty customFormPanel.rows}">
        <i>Aucun champ</i>
    </ui:fragment>

</ui:fragment>