<ui:composition template="/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <f:metadata>
        <f:viewAction action="#{testConfigurationBean.onLoad()}"/>
    </f:metadata>

    <ui:define name="content">
        <h1>${langBean.msg("fieldconfig.title")}</h1>
        <h:outputText
                value='${langBean.msg("fieldconfig.description")} ${testConfigurationBean.authenticatedUsername}'/>
        <h2>Unités spatiales</h2>
        <h3>Types d'unités spatiales</h3>
        <div class="ui-fluid">
            <h:form>

                <div class="field grid">

                    <p:selectOneMenu id="fieldCode" value="#{testConfigurationBean.selectedFieldCode}">
                        <f:selectItems value="#{testConfigurationBean.fieldCodes}"/>
                    </p:selectOneMenu>

                    <p:outputLabel for="serverUrl" styleClass="col-12 md:col-2"
                                   value='${langBean.msg("fieldconfig.server.label")}'/>
                    <div class="col-12 md:col-10">
                        <p:inputText id="serverUrl" value="#{testConfigurationBean.serverUrl}"/>
                    </div>
                    <p:commandButton value='${langBean.msg("fieldconfig.server.load")}'
                                     action="#{testConfigurationBean.loadThesaurusValue()}"
                                     update="globalThesaurusId,globalCollectionsId"/>
                    <p:commandButton value="Charger le thésaurus modèle"
                    action="#{testConfigurationBean.loadModelThesaurus()}"/>

                </div>
                <div class="field grid">
                    <p:outputLabel for="globalThesaurusId" styleClass="col-12 md:col-2"
                                   value='${langBean.msg("fieldconfig.thesaurus.label")}'/>
                    <div class="col-12 md:col-10">
                        <p:selectOneMenu id="globalThesaurusId"
                                         value="#{testConfigurationBean.selectedThesaurus}">
                            <f:selectItems value="#{testConfigurationBean.vocabularies}" var="vocab"
                                           itemLabel="#{vocab.vocabularyName} (#{vocab.externalVocabularyId})"
                                           itemValue="#{vocab.externalVocabularyId}"/>

                        </p:selectOneMenu>
                        <p:commandButton value='${langBean.msg("fieldconfig.thesaurus.load")}'
                                         action="#{testConfigurationBean.loadGroupValue()}"
                                         update="globalCollectionsId selectEntireThesaurus"/>
                    </div>
                </div>

                <p:selectBooleanCheckbox id="selectEntireThesaurus"
                                         value="#{testConfigurationBean.selectEntireThesaurus}"
                                         itemLabel='${langBean.msg("fieldconfig.thesaurus.complete")}'>
                    <p:ajax event="change" update="globalCollectionsId @this"
                            listener="#{testConfigurationBean.removeAllSelectedGroups}"/>
                </p:selectBooleanCheckbox>

                <div class="field grid">
                    <p:outputLabel for="globalCollectionsId" styleClass="col-12 md:col-2"
                                   value='${langBean.msg("fieldconfig.collections.label")}'/>
                    <div class="col-12 md:col-10">

                        <p:dataTable id="globalCollectionsId" var="group"
                                     value="#{testConfigurationBean.collections}"
                                     selection="#{testConfigurationBean.selectedGroups}"
                                     rowKey="#{group.externalId}"
                                     rows="5" selectionPageOnly="false" selectionRowMode="multiple"
                                     cellNavigation="true"
                                     paginator="true"
                                     selectionDisabled="#{testConfigurationBean.selectEntireThesaurus == true}">

                            <p:column selectionBox="true" style="width:16px;text-align:center"/>
                            <p:column headerText="ID">
                                <h:outputText value="#{group.externalId}"/>
                            </p:column>

                            <p:column headerText="Nom">
                                <h:outputText value="#{testConfigurationBean.labels.get(group.externalId)}"/>
                            </p:column>

                        </p:dataTable>

                    </div>
                </div>


                <p:commandButton value='${langBean.msg("commons.actions.save")}'
                                 action="#{testConfigurationBean.processForm()}"
                                 update="globalCollectionsId"/>

                <p:messages id="messages" showDetail="true" closable="true">
                    <p:autoUpdate/>
                </p:messages>

                <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
            </h:form>

            <p:button value='${langBean.msg("commons.actions.backhome")}' outcome="/index.xhtml"/>
        </div>
    </ui:define>

</ui:composition>