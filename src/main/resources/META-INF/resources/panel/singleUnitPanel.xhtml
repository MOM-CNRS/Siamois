<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:p="http://primefaces.org/ui"
        xmlns:cc="http://xmlns.jcp.org/jsf/composite">

    <cc:interface>
        <!-- Required attributes -->
        <cc:attribute name="panelIndex" required="true" type="java.lang.String"/>
        <cc:attribute name="panelModel" required="true"
                      type="fr.siamois.ui.bean.panel.models.panel.single.AbstractSingleEntity"/>
    </cc:interface>

    <cc:implementation>

        <!-- Error Message -->
        <p:staticMessage severity="error"
                         summary="Error"
                         closable="false"
                         detail="#{cc.attrs.panelModel.errorMessage}"
                         rendered="#{not empty cc.attrs.panelModel.errorMessage}"/>

        <h:panelGroup id="unitContentPanel"
                      rendered="#{cc.attrs.panelModel.unit != null}">

            <h:form id="singlePanelUnitForm-#{cc.attrs.panelIndex}">
                <input type="hidden"
                       name="${_csrf.parameterName}"
                       value="${_csrf.token}"/>

                <!-- Progress Bar -->
                <p:progressBar widgetVar="pbBarAjax_#{cc.attrs.panelIndex}"
                               id="progressBar"
                               styleClass="panel-progressbar"
                               style="height:3px"
                               mode="indeterminate"/>

                <!-- Breadcrumbs -->
                <p:outputPanel id="breadcrumbs">
                    <ui:repeat var="breadcrumbModel"
                               value="#{cc.attrs.panelModel.allParentBreadcrumbModels}">
                        <p:breadCrumb lastItemDisabled="true"
                                      styleClass="panel-bc"
                                      homeDisplay="text"
                                      model="#{breadcrumbModel}"/>
                    </ui:repeat>
                </p:outputPanel>

                <!-- Tabs -->
                <ui:include src="#{cc.attrs.panelModel.tabView}"/>

                <!-- Footer Toolbar -->
                <p:toolbar styleClass="panel-footer">
                    <p:toolbarGroup align="left">
                        <div style="display:flex; gap:1em; align-items:center;">

                            <div style="display:flex; flex-direction:column;">
                                <div style="display:flex; gap:1em;">

                                    <!-- Creation -->
                                    <small>
                                        <i>
                                            Créé le
                                            <span class="panel-history-colored-span">
                                                #{cc.attrs.panelModel.formatUtcDateTime(
                                                        cc.attrs.panelModel.unit.creationTime, false)}
                                            </span>
                                            par
                                            <span class="panel-history-colored-span">
                                                #{cc.attrs.panelModel.unit.createdBy.displayName()}
                                            </span>
                                        </i>
                                    </small>

                                    <!-- Update -->
                                    <small>
                                        <i>
                                            Modifié le
                                            <span class="panel-history-colored-span">
                                                #{cc.attrs.panelModel.lastUpdateDate()}
                                            </span>
                                            par
                                            <span class="panel-history-colored-span">
                                                #{cc.attrs.panelModel.lastUpdater()}
                                            </span>
                                        </i>
                                    </small>

                                    <!-- Validation -->
                                    <h:panelGroup rendered="#{cc.attrs.panelModel.unit.validated}">
                                        <small>
                                            <i>
                                                Validé le
                                                <span class="panel-history-colored-span">
                                                    #{cc.attrs.panelModel.formatUtcDateTime(
                                                            cc.attrs.panelModel.unit.validatedAt, false)}
                                                </span>
                                                par
                                                <span class="panel-history-colored-span">
                                                    #{cc.attrs.panelModel.unit.createdBy.displayName()}
                                                </span>
                                            </i>
                                        </small>
                                    </h:panelGroup>

                                </div>

                                <!-- Contributors -->
                                <small>
                                    <i>
                                        Contributeurs:
                                        <span class="panel-history-colored-span">
                                            #{cc.attrs.panelModel.allUpdaters()}
                                        </span>
                                    </i>
                                </small>
                            </div>

                            <div>
                                <p:commandButton disabled="true"
                                                 icon="bi bi-clock-history"/>
                            </div>

                        </div>
                    </p:toolbarGroup>
                </p:toolbar>

            </h:form>

        </h:panelGroup>

    </cc:implementation>

</ui:composition>