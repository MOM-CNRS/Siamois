<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
             xmlns:p="http://primefaces.org/ui"
             xmlns:h="http://xmlns.jcp.org/jsf/html"
             xmlns:f="http://xmlns.jcp.org/jsf/core"
>

    <!--@elvariable id="panelIndex" type="Integer"-->
    <!--@elvariable id="panelModel" type="fr.siamois.ui.bean.panel.models.panel.single.SpatialUnitPanel"-->

    <!-- Content -->
    <p:staticMessage severity="error" summary="Error" closable="false"
                     detail="#{panelModel.spatialUnitErrorMessage}"
                     rendered="#{not empty panelModel.spatialUnitErrorMessage}"/>
    <h:panelGroup id="spatialUnitContentPanel" rendered="#{panelModel.unit != null}">


        <h:form id="spatialUnitForm">
            <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>

            <!-- Tabs -->
            <p:tabView id="spatialUnitTabs" activeIndex="#{panelModel.activeTabIndex}">
                <p:ajax event="tabChange" listener="#{panelModel.onTabChange}"/>

                <!-- Overview tab -->
                <p:tab id="overviewTab">

                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value='#{langBean.msg("panel.tab.overview")}'/>
                            <ui:param name="icon" value="bi bi-eye"/>
                            <ui:param name="root" value="spatialUnitForm:spatialUnitTabs"/>
                        </ui:include>
                    </f:facet>

                    <ui:include src="/panel/spatialunit/tab/overviewTab.xhtml">
                        <ui:param name="panelModel" value="#{panelModel}"/>
                        <ui:param name="panelIndex" value="#{panelIndex}"/>
                        <ui:param name="root" value="spatialUnitForm:spatialUnitTabs"/>
                    </ui:include>

                </p:tab>

                <p:tab id="detailsTab">
                    <!-- Common fields -->
                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value='#{langBean.msg("panel.tab.details")}'/>
                            <ui:param name="icon" value="bi bi-info-circle"/>
                        </ui:include>
                    </f:facet>

                    <ui:include src="/panel/spatialunit/tab/detailsTab.xhtml">
                        <ui:param name="panelModel" value="#{panelModel}"/>
                        <ui:param name="panelIndex" value="#{panelIndex}"/>
                        <ui:param name="root" value="spatialUnitForm:spatialUnitTabs"/>
                    </ui:include>

                </p:tab>
                <p:tab title="Hierarchie" id="hierarchy">
                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value="Hierarchie"/>
                            <ui:param name="icon" value="bi bi-geo-alt"/>

                            <ui:param name="emptyTab" value="#{panelModel.isHierarchyTabEmpty()}"/>
                            <ui:param name="validated" value="#{panelModel.unit.validated}"/>
                        </ui:include>

                    </f:facet>

                    <ui:include src="/panel/spatialunit/tab/spatialHierarchyTab.xhtml">
                        <ui:param name="panelModel" value="#{panelModel}"/>
                        <ui:param name="panelIndex" value="#{panelIndex}"/>
                    </ui:include>
                </p:tab>
                <p:tab title="Actions">

                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value="Actions"/>
                            <ui:param name="icon" value="bi bi-arrow-down-square"/>
                            <ui:param name="emptyTab" value="#{panelModel.totalActionUnitCount == 0}"/>
                            <ui:param name="validated" value="#{panelModel.unit.validated}"/>
                        </ui:include>
                    </f:facet>

                    <ui:include src="/panel/spatialunit/tab/actionTab.xhtml">
                        <ui:param name="panelModel" value="#{panelModel}"/>
                        <ui:param name="panelIndex" value="#{panelIndex}"/>
                    </ui:include>

                </p:tab>
                <p:tab title="Enregistrements (1)">
                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value="Enregistrements ðŸš§"/>
                            <ui:param name="icon" value="bi bi-pencil-square"/>
                            <ui:param name="emptyTab" value="true"/>
                            <ui:param name="validated" value="#{panelModel.unit.validated}"/>
                        </ui:include>
                    </f:facet>

                    ðŸš§ En cours


                </p:tab>
                <p:tab title="Prelevements">
                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value="Prelevements ðŸš§"/>
                            <ui:param name="icon" value="bi bi-box2"/>
                            <ui:param name="emptyTab" value="true"/>
                            <ui:param name="validated" value="#{panelModel.unit.validated}"/>
                        </ui:include>
                    </f:facet>

                    ðŸš§ En cours

                </p:tab>


                <p:tab title="Documents" id="documentTab">

                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value="Documents"/>
                            <ui:param name="icon" value="bi bi-paperclip"/>
                            <ui:param name="emptyTab" value="#{panelModel.documents.size() == 0}"/>
                            <ui:param name="validated" value="#{panelModel.unit.validated}"/>
                        </ui:include>
                    </f:facet>

                    <ui:include src="/panel/spatialunit/tab/documentsTab.xhtml">
                        <ui:param name="count" value="4"/>
                    </ui:include>

                </p:tab>

                <p:tab title="Versions">
                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value="Versions"/>
                            <ui:param name="icon" value="bi bi-clock-history"/>
                        </ui:include>
                    </f:facet>

                    <ui:include src="/panel/spatialunit/tab/versionTab.xhtml">
                        <ui:param name="panelModel" value="#{panelModel}"/>
                    </ui:include>
                </p:tab>
            </p:tabView>

            <!-- Save/Cancel Toolbar -->
            <p:toolbar class="panel-footer" >
                <p:toolbarGroup align="left">
                    DerniÃ¨re modification le #{panelModel.unit.creationTime} par #{panelModel.unit.author.displayName()}
                    <p:commandButton id="seeHistoryButton" value="Historique"
                                     style="margin-left: 1rem">
                    </p:commandButton>
                </p:toolbarGroup>
                <p:toolbarGroup align="right" rendered="#{flowBean.readWriteMode == 'WRITE'}">
                    <p:commandLink value='#{langBean.msg("common.action.cancel")}'
                                   update="panel-#{panelIndex}"
                                   id="cancelButton"
                                   action="#{panelModel.cancelChanges()}"

                                   style="margin-right: 1rem">
                    </p:commandLink>
                    <p:commandButton id="saveButton" value='#{langBean.msg("common.action.save")}'
                                     update="panel-#{panelIndex}"

                                     action="#{panelModel.save(false)}"
                                     style="margin-right: 1rem">
                    </p:commandButton>
                    <p:commandButton id="saveAndValidateButton" value='#{langBean.msg("common.action.saveAndValidate")}'
                                     update="panel-#{panelIndex}"
                                     action="#{panelModel.save(true)}"

                                     style="margin-right: .5rem">
                    </p:commandButton>
                </p:toolbarGroup>
            </p:toolbar>
        </h:form>

    </h:panelGroup>
    <p:dialog id="idDisplayVersion" widgetVar="displayVersion" closeOnEscape="true">
        <h:form id="displayVersionForm">
            <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
            <h:panelGroup id="versionVisualizer" rendered="#{panelModel.revisionToDisplay != null}">
                <p>Name : #{panelModel.revisionToDisplay.name}</p>
                <p>Category : #{labelBean.findLabelOf(panelModel.revisionToDisplay.category)}</p>
            </h:panelGroup>
        </h:form>
    </p:dialog>
    <p:dialog widgetVar="restored-dlg" closeOnEscape="true" onHide="location.reload();">
        <h:outputText value="Version restaurÃ©e"/>
    </p:dialog>


</ui:fragment>