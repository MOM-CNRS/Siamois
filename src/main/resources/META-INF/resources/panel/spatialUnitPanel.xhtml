<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
             xmlns:p="http://primefaces.org/ui"
             xmlns:h="http://xmlns.jcp.org/jsf/html"
             xmlns:f="http://xmlns.jcp.org/jsf/core"
             xmlns:sharedInput="http://xmlns.jcp.org/jsf/composite/pages/shared/input"
>

    <!--@elvariable id="panelIndex" type="Integer"-->
    <!--@elvariable id="panelModel" type="fr.siamois.ui.bean.panel.models.panel.SpatialUnitPanel"-->

    <!-- Content -->
    <p:staticMessage severity="error" summary="Error" closable="false"
                     detail="#{panelModel.spatialUnitErrorMessage}"
                     rendered="#{not empty panelModel.spatialUnitErrorMessage}"/>
    <h:panelGroup id="contentPanel" rendered="#{panelModel.spatialUnit != null}">


        <h:form>
            <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
            <p:outputPanel>
                <div class="siamois-toolbar">
                    <p:toolbar>
                        <p:toolbarGroup>
                            <p:commandButton value='Nouvelle action' icon="pi pi-plus"
                                             update="flow"
                                             action="#{flowBean.addNewActionUnitPanel(panelModel.spatialUnit.id, panelIndex)}"
                                             style="margin-right: .5rem">
                            </p:commandButton>
                        </p:toolbarGroup>
                    </p:toolbar>
                </div>
            </p:outputPanel>
        </h:form>

        <h:form id="spatialUnitForm">
            <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
            <!-- Tabs -->
            <p:tabView id="spatialUnitTabs" activeIndex="#{panelModel.activeTabIndex}">
                <p:ajax event="tabChange" listener="#{panelModel.onTabChange}"/>

                <!-- Overview tab -->
                <p:tab title="Aperçu">

                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value="Aperçu"/>
                            <ui:param name="icon" value="bi bi-eye"/>
                        </ui:include>
                    </f:facet>

                    <ui:include src="/panel/spatialunit/tab/overviewTab.xhtml">
                        <ui:param name="spatialUnit" value="#{panelModel.spatialUnit}"/>
                    </ui:include>

                </p:tab>
                <p:tab title="Statistique">
                    <!-- overrides title on tab-->
                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value="Statistiques"/>
                            <ui:param name="icon" value="bi bi-bar-chart-line"/>
                        </ui:include>
                    </f:facet>

                    <p:chart value="#{panelModel.barModel}" style="width: 100%; height: 500px;">

                    </p:chart>
                </p:tab>
                <p:tab title="Détails" id="detailsTab">
                    <!-- Common fields -->
                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value="Details"/>
                            <ui:param name="icon" value="bi bi-info-circle"/>
                        </ui:include>
                    </f:facet>

                    <ui:include src="/panel/spatialunit/tab/detailsTab.xhtml">
                        <ui:param name="spatialUnit" value="#{panelModel.spatialUnit}"/>
                    </ui:include>

                </p:tab>
                <p:tab title="Hierarchie" id="hierarchy">
                    <f:facet name="title">
                        <div style="display:flex; align-items: center; gap:0.2em;">
                            <i class="bi bi-geo-alt"></i>
                            <h:outputText value="Hierarchie"/>
                            <p:chip icon="bi bi-arrow-down" styleClass="spatial-unit-count-chip-alt" label="3"/>
                            <p:chip icon="bi bi-arrow-up" styleClass="spatial-unit-count-chip-alt" label="4"/>
                        </div>
                    </f:facet>

                    <ui:include src="/panel/spatialunit/tab/hierachyTab.xhtml">
                        <ui:param name="panelModel" value="#{panelModel}"/>
                        <ui:param name="panelIndex" value="#{panelIndex}"/>
                    </ui:include>
                </p:tab>
                <p:tab title="Actions">

                    <f:facet name="title">
                        <div style="display:flex; align-items: center; gap:0.2em;">
                            <i class="bi bi-arrow-down-square"/>
                            <h:outputText value="Actions"/>
                            <p:chip styleClass="spatial-unit-count-chip-alt" label="4"/>
                        </div>
                    </f:facet>


                </p:tab>
                <p:tab title="Enregistrements (1)">
                    <f:facet name="title">
                        <div style="display:flex; align-items: center; gap:0.2em;">
                            <i class="bi bi-pencil-square"></i>
                            <h:outputText value="Enregistrements"/>
                            <p:chip styleClass="recording-unit-count-chip-alt" label="4"/>
                        </div>
                    </f:facet>




                </p:tab>
                <p:tab title="Prelevements">
                    <f:facet name="title">
                        <div style="display:flex; align-items: center; gap:0.2em;">
                            <i class="bi bi-box2"></i>
                            <h:outputText value="Prelevements"/>
                            <p:chip styleClass="recording-unit-count-chip-alt" label="4"/>
                        </div>
                    </f:facet>
                </p:tab>
                <p:tab title="Versions">
                    <f:facet name="title">
                        <div style="display:flex; gap:0.2em; align-items: center;">
                            <i class="bi bi-clock-history"></i>
                            <h:outputText value="Versions"/>
                            <p:chip styleClass="spatial-unit-count-chip-alt" label="4"/>
                        </div>
                    </f:facet>


                </p:tab>

                <p:tab title="Documents">

                    <f:facet name="title">
                        <ui:include src="/pages/shared/tab/tabTitle.xhtml">
                            <ui:param name="title" value="Documents"/>
                            <ui:param name="icon" value="bi bi-paperclip"/>
                            <ui:param name="count" value="4"/>
                            <ui:param name="countStyle" value="spatial-unit-count-chip-alt"/>
                        </ui:include>
                    </f:facet>

                    <ui:include src="/panel/spatialunit/tab/documentsTab.xhtml">
                        <ui:param name="count" value="4"/>
                    </ui:include>

                </p:tab>


            </p:tabView>

            <!-- Save/Cancel Toolbar -->
            <p:toolbar class="panel-footer">
                <p:toolbarGroup align="right">
                    <p:commandButton value='#{langBean.msg("common.action.cancelModifications")}'
                                     update="flow"
                                     disabled="true"
                                     styleClass="ui-button-danger"
                                     style="margin-right: .5rem">
                    </p:commandButton>
                    <p:commandButton id="saveButton" value='#{langBean.msg("common.action.save")}'
                                     update="panel-#{panelIndex}"
                                     action="#{panelModel.save()}"
                                     style="margin-right: .5rem">
                    </p:commandButton>
                </p:toolbarGroup>
            </p:toolbar>
        </h:form>

    </h:panelGroup>
    <p:dialog id="idDisplayVersion" widgetVar="displayVersion" closeOnEscape="true">
        <h:form id="displayVersionForm">
            <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
            <h:panelGroup id="versionVisualizer" rendered="#{panelModel.revisionToDisplay != null}">
                <p>Name : #{panelModel.revisionToDisplay.name}</p>
                <p>Category : #{labelBean.findLabelOf(panelModel.revisionToDisplay.category)}</p>
            </h:panelGroup>
        </h:form>
    </p:dialog>
    <p:dialog widgetVar="restored-dlg" closeOnEscape="true" onHide="location.reload();">
        <h:outputText value="Version restaurée"/>
    </p:dialog>

    <ui:include src="/dialog/document/newDocument.xhtml"/>


</ui:fragment>